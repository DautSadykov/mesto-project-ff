(()=>{"use strict";var t="https://nomoreparties.co/v1/wff-cohort-20",e={authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"};function n(t,e,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__like-button"),i=c.querySelector(".card__like-counter");c.querySelector(".card__title").textContent=t.name,c.querySelector(".card__image").alt=t.name,c.querySelector(".card__image").src=t.link,function(t,e,n){t.likes.some((function(t){return t._id===n}))&&e.classList.add("card__like-button_is-active")}(t,a,r),a.addEventListener("click",(function(){return e(t,a,i)})),i.textContent=t.likes.length;var u=c.querySelector(".card__delete-button");return t.owner._id!==r&&u.classList.add("card_delete-button_disabled"),u.addEventListener("click",(function(){n(u,t._id)})),c.querySelector(".card__image").addEventListener("click",(function(){return o(t)})),c}function o(n,o,r){o.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(t,"/cards/likes/").concat(n._id),{method:"DELETE",headers:{authorization:e.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n).then((function(t){o.classList.toggle("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(t){console.error(t)})):function(n){return fetch("".concat(t,"/cards/likes/").concat(n._id),{method:"PUT",headers:{authorization:e.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n).then((function(t){o.classList.toggle("card__like-button_is-active"),r.textContent=t.likes.length})).catch((function(t){console.error(t)}))}function r(t,e){var n=t.closest(".card");(function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-20/cards/".concat(t),{method:"DELETE",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"}})})(e).then((function(){n.remove()})).catch((function(t){console.error(t)}))}function c(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",i)}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",i)}function i(t){"Escape"===t.key&&a(document.querySelector(".popup_is-opened"))}function u(t,e){e.querySelector(".popup__button").textContent=t?"Сохраняется...":"Сохранить"}function s(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));o&&(o.classList.remove("popup__input-error-text_active"),o.textContent=""),e.classList.remove(n),e.setCustomValidity("")}function l(t){return t.some((function(t){return!t.validity.valid}))}function d(t,e,n){l(t)?(e.classList.add(n),e.disabled=!0):(e.classList.remove(n),e.disabled=!1)}function p(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){s(t,n,e.inputErrorClass)}));var n=t.querySelector(e.submitButtonSelector);n.classList.add(e.inactiveButtonClass),n.disabled=!0}var f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorActiveClass:"popup__input-error-text_active"},_=document.querySelector(".places__list"),m=document.querySelectorAll(".popup"),y=document.querySelector(".profile__image"),h=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),S="";function b(t){var e=document.querySelector(".popup_type_image");e.querySelector(".popup__image").src=t.link,e.querySelector(".popup__caption").textContent=t.name,c(e)}fetch("".concat(t,"/users/me"),{method:"GET",headers:{authorization:e.authorization,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(c){y.style.backgroundImage="url('".concat(c.avatar,"')"),h.textContent=c.name,v.textContent=c.about,S=c._id,fetch("".concat(t,"/cards"),{headers:{authorization:e.authorization}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.forEach((function(t){_.append(n(t,o,r,b,S))}))})).catch((function(t){console.error(t)}))})),m.forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target.classList.contains("popup__close")&&a(t),function(t){t.target.classList.contains("popup")&&a(t.target)}(e)}))}));var q=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),C=document.forms.editProfile,L=C.querySelector(".popup__input_type_name"),E=C.querySelector(".popup__input_type_description");function g(){L.value=document.querySelector(".profile__title").textContent,E.value=document.querySelector(".profile__description").textContent}g(),q.addEventListener("click",(function(){c(k),g(),p(C,f)})),C.addEventListener("submit",(function(n){n.preventDefault();var o=L.value,r=E.value;u(!0,k),function(n,o){return fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:e.authorization,"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(o,r).then((function(t){h.textContent=t.name,v.textContent=t.about,a(k)})).catch((function(t){console.error(t)})).finally((function(){u(!1,k)}))}));var j=document.querySelector(".profile__add-button"),x=document.querySelector(".popup_type_new-card"),T=document.forms.newPlace;j.addEventListener("click",(function(){c(x),p(T,f)}));var z=T.querySelector(".popup__input_type_card-name"),P=T.querySelector(".popup__input_type_url");T.addEventListener("submit",(function(t){t.preventDefault();var e=z.value,c=P.value;u(!0,x),function(t,e){return fetch("https://nomoreparties.co/v1/wff-cohort-20/cards",{method:"POST",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"},body:JSON.stringify({name:t,link:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(e,c).then((function(e){_.prepend(n(e,o,r,b,S)),a(x),t.target.reset()})).catch((function(t){console.error(t)})).finally((function(){u(!1,x)}))}));var A,w=document.querySelector(".profile__change-avatar-button"),B=document.querySelector(".popup_type_avatar"),D=document.querySelector(".popup__input_type_avatar"),N=document.forms.changeAvatar;w.addEventListener("click",(function(){c(B),p(N,f)})),N.addEventListener("submit",(function(t){t.preventDefault();var e=D.value;u(!0,B),function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-20/users/me/avatar",{method:"PATCH",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(e).then((function(e){y.style.backgroundImage="url('".concat(e.avatar,"')"),a(B),t.target.reset()})).catch((function(t){console.error(t)})).finally((function(){u(!1,B)}))})),A=f,Array.from(document.querySelectorAll(A.formSelector)).forEach((function(t){(function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);d(n,o),l(n),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,o,r){var c=t.querySelector(".".concat(e.id,"-error"));c.textContent=n,c.classList.add(r),e.classList.add(o)}(t,e,e.validationMessage,n,o)}(t,r,e.inputErrorClass,e.inputErrorActiveClass),l(n),d(n,o,e.inactiveButtonClass)}))}))})(t,A),t.addEventListener("submit",(function(t){t.preventDefault()}))}))})();