(()=>{"use strict";var t="b91af8f2-857f-407b-86ef-9cd78ad6bef5";function e(t,e,o,n){var r=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=r.querySelector(".card__like-button"),a=r.querySelector(".card__like-counter");r.querySelector(".card__title").textContent=t.name,r.querySelector(".card__image").alt=t.name,r.querySelector(".card__image").src=t.link,function(t,e){t.likes.some((function(t){return"7dda96ba60d1cabf61e4db4a"===t._id}))&&e.classList.add("card__like-button_is-active")}(t,c),c.addEventListener("click",(function(){return e(t,c,a)})),a.textContent=t.likes.length;var i=r.querySelector(".card__delete-button");return i.addEventListener("click",(function(){o(i,t._id)})),"7dda96ba60d1cabf61e4db4a"!==t.owner._id&&i.classList.add("card_delete-button_disabled"),r.querySelector(".card__image").addEventListener("click",(function(){return n(t)})),r}function o(t,e,o){e.classList.contains("card__like-button_is-active")?function(t,e,o){fetch("https://nomoreparties.co/v1/wff-cohort-20/cards/likes/".concat(t._id),{method:"DELETE",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){e.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(t){console.error(t)}))}(t,e,o):function(t,e,o){fetch("https://nomoreparties.co/v1/wff-cohort-20/cards/likes/".concat(t._id),{method:"PUT",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){e.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(t){console.error(t)}))}(t,e,o)}function n(t,e){var o=t.closest(".card");fetch("https://nomoreparties.co/v1/wff-cohort-20/cards/".concat(e),{method:"DELETE",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"}}).catch((function(t){console.error(t)})),o.remove()}function r(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function c(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function a(t){"Escape"===t.key&&c(document.querySelector(".popup_is-opened"))}function i(t,e){document.querySelector(".popup__button").textContent=t?"Сохраняется...":"Сохранить"}function u(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));n&&(n.classList.remove("popup__input-error-text_active"),n.textContent=""),e.classList.remove(o)}function s(t){return t.some((function(t){return!t.validity.valid}))}function l(t,e,o){s(t)?(e.classList.add(o),e.disabled=!0):(e.classList.remove(o),e.disabled=!1)}function d(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(o){u(t,o,e.inputErrorClass)}));var o=t.querySelector(e.submitButtonSelector);o.classList.add(e.inactiveButtonClass),o.disabled=!0}var p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},f=document.querySelector(".places__list"),_=document.querySelectorAll(".popup"),m=document.querySelector(".profile__image"),v=document.querySelector(".profile__title"),h=document.querySelector(".profile__description");function y(t){var e=document.querySelector(".popup_type_image");e.querySelector(".popup__image").src=t.link,e.querySelector(".popup__caption").textContent=t.name,r(e)}!function(t,e,o){fetch("https://nomoreparties.co/v1/wff-cohort-20/users/me",{method:"GET",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(n){t.style.backgroundImage="url('".concat(n.avatar,"')"),e.textContent=n.name,o.textContent=n.about}))}(m,v,h),function(r,c){fetch("https://nomoreparties.co/v1/wff-cohort-20/cards",{headers:{authorization:t}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){t.forEach((function(t){r.append(e(t,o,n,c))}))}))}(f,y),_.forEach((function(t){t.classList.add("popup_is-animated"),t.addEventListener("click",(function(e){e.target.classList.contains("popup__close")&&c(t)})),window.addEventListener("click",(function(t){!function(t){t.target.classList.contains("popup")&&c(t.target)}(t)}))}));var b=document.querySelector(".profile__edit-button"),S=document.querySelector(".popup_type_edit"),q=document.forms.editProfile,k=q.querySelector(".popup__input_type_name"),L=q.querySelector(".popup__input_type_description");function C(){k.value=document.querySelector(".profile__title").textContent,L.value=document.querySelector(".profile__description").textContent}C(),b.addEventListener("click",(function(){r(S),C(),d(q,p)})),q.addEventListener("submit",(function(t){t.preventDefault();var e=k.value,o=L.value;i(!0),fetch("https://nomoreparties.co/v1/wff-cohort-20/users/me",{method:"PATCH",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){v.textContent=t.name,h.textContent=t.about})).catch((function(t){console.error(t)})).finally((function(){i(!1)})),c(S)}));var E=document.querySelector(".profile__add-button"),g=document.querySelector(".popup_type_new-card"),j=document.forms.newPlace;E.addEventListener("click",(function(){r(g),d(j,p)}));var x=j.querySelector(".popup__input_type_card-name"),w=j.querySelector(".popup__input_type_url");j.addEventListener("submit",(function(t){t.preventDefault();var r=x.value,a=w.value;i(!0),fetch("https://nomoreparties.co/v1/wff-cohort-20/cards",{method:"POST",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"},body:JSON.stringify({name:r,link:a})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){f.prepend(e(t,o,n,y))})).catch((function(t){console.error(t)})).finally((function(){i(!1)})),c(g),t.target.reset()}));var T,P=document.querySelector(".profile__change-avatar-button"),A=document.querySelector(".popup_type_avatar"),z=document.querySelector(".popup__input_type_avatar"),B=document.forms.changeAvatar;P.addEventListener("click",(function(){r(A),d(B,p)})),B.addEventListener("submit",(function(t){t.preventDefault();var e=z.value;i(!0),fetch("https://nomoreparties.co/v1/wff-cohort-20/users/me/avatar",{method:"PATCH",headers:{authorization:"b91af8f2-857f-407b-86ef-9cd78ad6bef5","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t.avatar),m.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.error(t)})).finally((function(){i(!1)})),c(A),t.target.reset()})),T=p,Array.from(document.querySelectorAll(T.formSelector)).forEach((function(t){(function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);l(o,n),s(o),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity("Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"):e.setCustomValidity(""),e.validity.valid?u(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));r.textContent=o,r.classList.add("popup__input-error-text_active"),e.classList.add(n)}(t,e,e.validationMessage,o)}(t,r,e.inputErrorClass),s(o),l(o,n,e.inactiveButtonClass)}))}))})(t,T),t.addEventListener("submit",(function(t){t.preventDefault()}))}))})();